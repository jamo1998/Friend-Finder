<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>FriendFinder Survey Page</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.7/js/all.js"></script>
    <script src="../data/friends.js"></script>

</head>

<body>

	<div class="container">
		<div>
			<h2>Survey Questions</h2>
			<h3><strong>Who are You?</strong></h3>
			<h4>Name (Required)</h4>
		<input type="text" name="" id="friendName" class="form-control" required >

		<h4>Link to Photo Image (Required)</h4>
		<input type="text" name="" id="friendImg" class="form-control" required >

		<hr>

		<h3><strong>Question 1</strong></h3>
		<h4>Your mind is always buzzing with unexplored ideas and plans.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q1">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>

		<h3><strong>Question 2</strong></h3>
		<h4>Generally speaking, you rely more on your experience than your imagination.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q2">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>


		<h3><strong>Question 3</strong></h3>
		<h4>You find it easy to stay relaxed and focused even when there is some pressure.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q3">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>


		<h3><strong>Question 4</strong></h3>
		<h4>You are generally an outdoors person.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q4">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>


		<h3><strong>Question 5</strong></h3>
		<h4>People can rarely upset you.
        </h4>
	 	<select data-placeholder="" class="chosen-select" id="q5">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>


		<h3><strong>Question 6</strong></h3>
		<h4>It is often difficult for you to relate to other people’s feelings.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q6">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>


		<h3><strong>Question 7</strong></h3>
		<h4>n a discussion, truth should be more important than people’s sensitivities.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q7">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>

		<h3><strong>Question 8</strong></h3>
		<h4>You rarely get carried away by fantasies and ideas.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q8">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>

		<h3><strong>Question 9</strong></h3>
		<h4>You think that everyone’s views should be respected regardless of whether they are supported by facts or not.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q9">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>

		<h3><strong>Question 10</strong></h3>
		<h4>You feel more energetic after spending time with a group of people.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q10">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>

		<br>
		<br>

		<!-- Submit Button -->
		<button type="submit" class="btn btn-primary btn-lg btn-block" id="submit"><i class="fa fa-check-circle" aria-hidden="true"></i>
 		Submit</button>

		<hr>
	    <footer class="footer">
	      <div class="container">
		  <p><a href="/api/friends">API Friends List</a> | <a href="https://github.com/jamo1998/Friend-Finder">GitHub Repo</a></p>
	      </div>
	    </footer>

	</div>

	<div class="modal" id="executeModal" tabindex="-1" role="dialog">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h3 class="modal-title">Friend Match</h3>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				</div>
				<div class="modal-body">
					<h4>Your new friend's name is: <span id="matchName"></span></h4>
					<img id="matchImg">
					<!-- <p>Modal body text goes here.</p> -->
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

<!-- //This section sends form data to our server -->

<script type="text/javascript">
  var sum = [];
  var index = 0;
  var num = sum[0];

  //scores();

  $(document).on("click", "#submit", function(){
    event.preventDefault();

    validate();

    if (validate() === true) {
        var name = $("#matchName").val().trim();
        var photo = $("#matchImg").val().trim();
        var scores = [];
        var userSum = 0;

        for (i = 1; i < 11; i++) {
            var score = parseInt($("#q" + i).val());
            scores.push(score);
            
            userSum += parseInt($("#q"+ i).val());
        }

        var newFriend = {
            name: name,
            photo: photo,
            scores: scores
        }

        friends.push(newFriend);
        console.log(friends);
        console.log(sum);
        compare(userSum, sum)
        modalDisplay(friends, index);

        $.post("/api/friends", newFriend, function(data) {
            console.log("-------")
            console.log(data);
            console.log("-------")
            $("#matchName").val("");
            $("#matchImg").val("");
            for (j = 1; j < 11; j++) {
                $("#q" + j).val("");
            }   
            
        });
    } else {
        alert("You Are Missing Answers. Please Fill Out Form Completely.")
    }
});

function validate() {
    var isValid = true;

    $(".form-control").each(function() {
        if ($(this).val() === "") {
            isValid = false;
        }
    });

    $(".chosen-select").each(function() {
        if ($(this).val() === "") {
            isValid = false;
        }
    });

    return isValid;
};

function compare (userSum, sum) {
    console.log(userSum)
    for (i = 0; i < sum.length; i++) {
        console.log("num = " + num)
        userSum = parseInt(userSum);
        if (Math.abs(userSum-sum[i]) < Math.abs(userSum-num)) {
            num = sum[i];
            index = i;
        }
    }
    console.log("Your match: " + num + "-" + index);
}

function modalDisplay(friends, index) {
    $("#matchName").text(friends[index].name);
    $("#matchPhoto").attr("src", friends[index].photo);
    $("#executeModal").modal("toggle");
    console.log(friends[index].name);
}	
</script>


</body>
</html>
